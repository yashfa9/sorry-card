<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sorry ‚Äî Please Accept</title>

  <!-- Tailwind (kept as before) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>

  <!-- Canvas Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root{
      --card-bg: rgba(255,255,255,0.92);
      --muted: #6b5776;
    }
    html,body{ height:100%; margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: linear-gradient(135deg,#fff0f3 0%, #f0f7ff 100%); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; overflow:hidden; }
    #app { position:relative; width:100%; height:100vh; display:flex; align-items:center; justify-content:center; }

    /* Background canvas (Three.js) */
    #bg { position:fixed; inset:0; z-index:0; }

    /* GLITTER canvas overlay */
    #glitterCanvas { position:fixed; inset:0; z-index:2; pointer-events:none; }

    /* Card */
    .card {
      z-index: 10;
      width: min(980px, 92%);
      background: var(--card-bg);
      border-radius: 20px;
      padding: 36px;
      box-shadow: 0 18px 50px rgba(43,20,60,0.08);
      backdrop-filter: blur(6px);
      text-align:center;
      position:relative;
      overflow:visible;
    }

    .headline {
      font-size: clamp(28px, 4.5vw, 44px);
      font-weight: 800;
      margin: 6px 0 2px;
      color: transparent;
      background: linear-gradient(90deg,#f43f5e,#ff8fb1,#ffd78a);
      -webkit-background-clip:text; background-clip:text;
    }

    .sub {
      color: var(--muted);
      margin-bottom: 18px;
      font-weight:600;
    }

    .sorryBig {
      font-weight: 900;
      font-size: clamp(52px, 9vw, 110px);
      margin: 18px 0;
      line-height:0.9;
      text-shadow: 0 14px 30px rgba(180,100,130,0.08);
      color: #4b2350;
    }

    /* broken heart svg wrapper */
    .broken-wrap { display:flex; justify-content:center; align-items:center; margin: 10px 0 18px; }

    .btn {
      display:inline-block;
      background: linear-gradient(90deg,#ef476f,#ff6b9a);
      color:white;
      padding: 12px 26px;
      border-radius: 999px;
      border:0;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 8px 30px rgba(239,71,111,0.14);
      transition: transform .15s ease, box-shadow .15s ease, opacity .2s;
    }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 12px 34px rgba(239,71,111,0.18); }
    .btn:active { transform: translateY(0); }

    .choice-row { display:flex; gap:18px; justify-content:center; margin-top:18px; flex-wrap:wrap; }
    .choice { background: linear-gradient(180deg,#fff,#fff); border-radius:14px; padding:12px 18px; box-shadow:0 10px 30px rgba(40,22,48,0.06); cursor:pointer; min-width:140px; font-weight:700; }
    .choice.affirm { background: linear-gradient(90deg,#7ee7d5,#5fd3b6); color:#064c46; }
    .choice.defer { background: linear-gradient(90deg,#ffd6e0,#ffc1d6); color:#5a1f2e; }

    .message { margin-top:16px; color: #5b4963; font-weight:600; }

    .cute-img {
      width: 180px;
      margin-top: 16px;
      border-radius: 14px;
      box-shadow: 0 12px 40px rgba(66,18,52,0.08);
      transform-origin:center;
    }

    .hidden { display:none; }

    /* small footer */
    .footer { color: #8a6f8f; margin-top: 14px; font-size:14px; }

    /* Next-screen layout (full replacement inside card) */
    .next-screen {
      padding: 8px 6px;
    }
    .bubble {
      display:inline-block;
      background: linear-gradient(180deg,#fff,#fff);
      padding:12px 18px;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(40,22,48,0.05);
      font-weight:700;
      color:#3b2a3b;
      margin-top:10px;
    }
    .small-note { font-size:14px; color:#6b5776; margin-top:8px; }

    /* cinematic page screens (full replacement) */
    .scene {
      z-index: 11;
      width:100%;
      min-height:120px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
    }
    .scene h2 { font-size:22px; margin-bottom:8px; color:#4b2350; font-weight:800; }
    .scene p { color:#5b4963; font-weight:700; }

    /* responsive */
    @media (max-width:520px){
      .card { padding:20px; }
      .sorryBig { font-size: 52px; }
      .cute-img { width: 120px; }
    }

    /* small boom flash overlay */
    #boomFlash {
      position:fixed; inset:0; background: radial-gradient(circle,#ffffff55 0%, #ffffff00 40%); pointer-events:none; z-index:18; opacity:0;
    }
  </style>
</head>
<body>
  <canvas id="bg"></canvas>
  <canvas id="glitterCanvas"></canvas>
  <div id="boomFlash"></div>

  <!-- background music (plays on first interaction) -->
  <audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5a292a77aa.mp3?filename=cute-love-110874.mp3" loop preload="auto"></audio>

  <div id="app">
    <div class="card" role="main" aria-labelledby="title">
      <div id="title" class="headline">I Need To Say...</div>
      <div class="sub"></div>

      <!-- Stage 1 -->
      <div id="stage1" class="stage scene">
        <div id="sorryText" class="sorryBig">Raza üíù</div>

        <div class="broken-wrap" aria-hidden="true">
          <!-- Broken heart SVG (two halves) -->
          <svg id="brokenHeart" width="160" height="150" viewBox="0 0 200 180" xmlns="http://www.w3.org/2000/svg" style="overflow:visible">
            <path id="leftHalf" d="M100 30 C85 10, 40 15, 50 60 C52 84, 100 120, 100 150 C100 120, 100 90, 100 30 Z"
              fill="#ff6b8a" stroke="#ff4d6d" stroke-width="2" />
            <path id="rightHalf" d="M100 30 C115 10, 160 15, 150 60 C148 84, 100 120, 100 150 C100 120, 100 90, 100 30 Z"
              fill="#ff9fb3" stroke="#ff4d6d" stroke-width="2" />
            <path id="crack" d="M100 30 L93 56 L106 82 L93 108 L104 132" stroke="#7f3f4a" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </div>

        <div style="margin-top:12px;">
          <button id="sayBtn" class="btn" aria-label="Say Sorry">OPEN!</button>
        </div>
      </div>

      <!-- Stage 2: choices -->
      <div id="stage2" class="stage scene hidden">
        <div class="message">ap meri sorry accept kro gye yea nhi?</div>
        <div class="choice-row" role="group" aria-label="choices">
          <button id="acceptBtn" class="choice affirm" aria-label="Accept">üíñ Accept</button>
          <button id="notNowBtn" class="choice defer" aria-label="Not Now">üòî Not now</button>
        </div>
        <div id="stage2Hint" class="message" style="opacity:0.9; margin-top:10px;"></div>
      </div>

      <!-- Stage: wait choices (for Not Now) -->
      <div id="stageWait" class="stage scene hidden" aria-live="polite">
        <div class="message" id="waitMsg" style="font-size:18px; font-weight:700; color:#4d3a52;">tu pir yea he bta du kitny din wait kro?</div>
        <div class="choice-row" style="margin-top:14px;">
          <button id="oneDayBtn" class="choice affirm">1 day</button>
          <button id="oneWeekBtn" class="choice defer">1 week</button>
        </div>
        <div id="waitResult" class="small-note" style="opacity:0.95; margin-top:12px;"></div>
        <div style="margin-top:12px;">
          <button id="backFromWait" class="btn" style="background:linear-gradient(90deg,#8b5cf6,#6d28d9)">Back</button>
        </div>
      </div>

      <!-- Stage 3: result - accepted (kept for backward compatibility) -->
      <div id="stage3Accept" class="stage scene hidden" aria-live="polite">
        <div class="message" id="acceptMsg" style="font-size:20px; font-weight:800; color:#5a2a4a;">Thank you!üíï</div>
        <img id="cuteImage" class="cute-img hidden" src="cute.png" alt="cute" onerror="this.style.display='none'">
        <div style="margin-top:12px;">
          <button id="closeAccept" class="btn" style="background:linear-gradient(90deg,#8b5cf6,#6d28d9)">Close</button>
        </div>
      </div>

      <!-- Stage 3: result - not now (kept minimal) -->
      <div id="stage3Not" class="stage scene hidden" aria-live="polite">
        <div class="message" id="notMsg" style="font-size:19px; font-weight:700; color:#4d3a52;">It‚Äôs okay,  m pir wait kro gi‚Ä¶ ü•∫</div>
        <div style="margin-top:12px;">
          <button id="tryLater" class="btn" style="background:linear-gradient(90deg,#f97316,#fb923c)">Try Again Later</button>
        </div>
      </div>

      <!-- NEW: Next-screen after Accept (full replacement style) -->
      <div id="stageNext" class="stage scene hidden next-screen" aria-live="polite">
        <div id="nextHeader" class="bubble" style="background: linear-gradient(90deg,#fff6fb,#fff); font-size:20px;">Thank you!üíï</div>

        <div id="qWrap" style="margin-top:18px;">
          <div class="bubble" id="qText" style="font-size:17px;">kia m tumhari hun?</div>
          <div class="choice-row" style="margin-top:12px;">
            <button id="haanBtn" class="choice affirm">haan</button>
            <button id="naBtn" class="choice defer">na</button>
          </div>
        </div>

        <div id="answerWrap" style="margin-top:16px; min-height:46px;">
          <!-- responses appear here -->
        </div>

        <div style="margin-top:12px;">
          <button id="closeNext" class="btn" style="background:linear-gradient(90deg,#8b5cf6,#6d28d9)">Done</button>
        </div>
      </div>

      <!-- NEW separate cinematic result screens (one per answer) -->
      <div id="stageHaan" class="stage scene hidden" aria-live="polite">
        <h2>üí•</h2>
        <p style="font-weight:800; font-size:18px;">pir meri galti bhi tu apki galti hui na, mje q maffi maangni pr rhi hai? üòí</p>
        <div style="margin-top:12px;">
          <button id="doneHaan" class="btn" style="background:linear-gradient(90deg,#34d399,#059669)">Done</button>
        </div>
      </div>

      <div id="stageNa" class="stage scene hidden" aria-live="polite">
        <h2>üòî</h2>
        <p style="font-weight:800; font-size:18px;">ap se yea umeed nhi thii üòî</p>
        <div style="margin-top:12px;">
          <button id="doneNa" class="btn" style="background:linear-gradient(90deg,#f97316,#fb923c)">Done</button>
        </div>
      </div>

      <div id="stageOneDay" class="stage scene hidden" aria-live="polite">
        <h2>üéâ</h2>
        <p style="font-weight:800; font-size:18px;">okay g üòä</p>
        <div style="margin-top:12px;">
          <button id="doneDay" class="btn" style="background:linear-gradient(90deg,#8b5cf6,#6d28d9)">Done</button>
        </div>
      </div>

      <div id="stageOneWeek" class="stage scene hidden" aria-live="polite">
        <h2>üòû</h2>
        <p style="font-weight:800; font-size:18px;">acha üòû</p>
        <div style="margin-top:12px;">
          <button id="doneWeek" class="btn" style="background:linear-gradient(90deg,#ef476f,#ff6b9a)">Done</button>
        </div>
      </div>

      <div class="footer">Made by YASHFA ‚ú®</div>
    </div>
  </div>

<script>
/* ----------------------
  Background floating hearts with Three.js
   (UNCHANGED - kept as-is)
   ---------------------- */
(function(){
  const canvas = document.getElementById('bg');
  const renderer = new THREE.WebGLRenderer({ canvas, alpha:true, antialias:true });
  renderer.setPixelRatio(window.devicePixelRatio || 1);
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.z = 45;
  renderer.setSize(window.innerWidth, window.innerHeight);

  function createHeartShape(scale=1){
    const x=0,y=0;
    const s = new THREE.Shape();
    s.moveTo(x+0.5*scale, y+0.5*scale);
    s.bezierCurveTo(x+0.5*scale, y+0.5*scale, x+1*scale, y, x, y);
    s.bezierCurveTo(x-1*scale, y, x-1*scale, y+1.2*scale, x-1*scale, y+1.2*scale);
    s.bezierCurveTo(x-1*scale, y+2*scale, x+0.5*scale, y+2.8*scale, x+0.5*scale, y+2.8*scale);
    s.bezierCurveTo(x+0.5*scale, y+2.8*scale, x+1.6*scale, y+2*scale, x+1.6*scale, y+1.2*scale);
    s.bezierCurveTo(x+1.6*scale, y+1.2*scale, x+1.6*scale, y, x+1*scale, y);
    s.bezierCurveTo(x+0.5*scale, y, x+0.5*scale, y+0.5*scale, x+0.5*scale, y+0.5*scale);
    return s;
  }

  const geometry = new THREE.ExtrudeGeometry(createHeartShape(1), { depth:0.2, bevelEnabled:true, bevelSegments:2, steps:1, bevelSize:0.12, bevelThickness:0.12 });

  const hearts=[]; const palette=[0xff7b9b,0xff9fb3,0xffc7d0,0xffe8f0];
  for(let i=0;i<24;i++){
    const mat = new THREE.MeshPhongMaterial({ color: palette[Math.floor(Math.random()*palette.length)], transparent:true, opacity:0.86, shininess:20 });
    const m = new THREE.Mesh(geometry, mat);
    m.position.x = (Math.random()-0.5)*80;
    m.position.y = (Math.random()-0.5)*40;
    m.position.z = (Math.random()-0.5)*60 - 20;
    const s = Math.random()*0.8 + 0.35; m.scale.set(s,s,s);
    m.userData = { ox: m.position.x, oy: m.position.y, oz: m.position.z, rx: (Math.random()*0.004)-0.002, ry: (Math.random()*0.005)-0.0025, floatR: 2 + Math.random()*5, sx: Math.random()*0.02 - 0.01, sy: Math.random()*0.02 - 0.01 };
    m.rotation.x = Math.random()*Math.PI; m.rotation.y = Math.random()*Math.PI;
    scene.add(m); hearts.push(m);
  }

  scene.add(new THREE.AmbientLight(0xffffff, 0.45));
  const dl = new THREE.DirectionalLight(0xffffff, 0.7); dl.position.set(12,12,40); scene.add(dl);

  function loop(){
    const t = Date.now()*0.001;
    hearts.forEach(h=>{
      h.position.x = h.userData.ox + Math.sin(t*(0.7 + h.userData.sx*10))*h.userData.floatR;
      h.position.y = h.userData.oy + Math.cos(t*(0.5 + h.userData.sy*10))*h.userData.floatR;
      h.rotation.x += h.userData.rx; h.rotation.y += h.userData.ry;
    });
    renderer.render(scene, camera);
    requestAnimationFrame(loop);
  }
  loop();

  window.addEventListener('resize', ()=> {
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix();
  });
})();

/* ----------------------
  GLITTER canvas (soft falling sparkles)
  ---------------------- */
(function(){
  const cv = document.getElementById('glitterCanvas');
  const ctx = cv.getContext('2d');
  function resize(){ cv.width = window.innerWidth; cv.height = window.innerHeight; }
  resize(); window.addEventListener('resize', resize);
  const sparks = [];
  for(let i=0;i<70;i++){
    sparks.push({ x: Math.random()*cv.width, y: Math.random()*cv.height, r: Math.random()*1.8+0.6, vx: (Math.random()-0.5)*0.2, vy: Math.random()*0.6+0.2, alpha: Math.random()*0.7+0.15 });
  }
  function anim(){
    ctx.clearRect(0,0,cv.width,cv.height);
    for(const s of sparks){
      ctx.beginPath();
      ctx.fillStyle = "rgba(255,255,255,"+s.alpha+")";
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      ctx.fill();
      s.x += s.vx; s.y += s.vy;
      if(s.y > cv.height + 10){ s.y = -10; s.x = Math.random()*cv.width; }
      if(s.x < -20) s.x = cv.width + 10;
      if(s.x > cv.width + 20) s.x = -10;
    }
    requestAnimationFrame(anim);
  }
  anim();
})();

/* ----------------------
  UI interactions + cinematic BOOM transitions + music
  ---------------------- */
(function(){
  // elements
  const sayBtn = document.getElementById('sayBtn');
  const stage1 = document.getElementById('stage1');
  const stage2 = document.getElementById('stage2');
  const stageWait = document.getElementById('stageWait');
  const acceptBtn = document.getElementById('acceptBtn');
  const notNowBtn = document.getElementById('notNowBtn');
  const stage3A = document.getElementById('stage3Accept');
  const stage3N = document.getElementById('stage3Not');
  const stageNext = document.getElementById('stageNext');
  const cuteImage = document.getElementById('cuteImage');
  const closeAccept = document.getElementById('closeAccept');
  const tryLater = document.getElementById('tryLater');
  const sorryText = document.getElementById('sorryText');
  const leftHalf = document.getElementById('leftHalf');
  const rightHalf = document.getElementById('rightHalf');
  const crack = document.getElementById('crack');
  const boomFlash = document.getElementById('boomFlash');

  // next / result elements
  const haanBtn = document.getElementById('haanBtn');
  const naBtn = document.getElementById('naBtn');
  const answerWrap = document.getElementById('answerWrap');
  const closeNext = document.getElementById('closeNext');

  const oneDayBtn = document.getElementById('oneDayBtn');
  const oneWeekBtn = document.getElementById('oneWeekBtn');
  const waitResult = document.getElementById('waitResult');
  const backFromWait = document.getElementById('backFromWait');

  const stageHaan = document.getElementById('stageHaan');
  const stageNa = document.getElementById('stageNa');
  const stageOneDay = document.getElementById('stageOneDay');
  const stageOneWeek = document.getElementById('stageOneWeek');
  const doneHaan = document.getElementById('doneHaan');
  const doneNa = document.getElementById('doneNa');
  const doneDay = document.getElementById('doneDay');
  const doneWeek = document.getElementById('doneWeek');

  const bgMusic = document.getElementById('bgMusic');

  // gentle floating of main sorry text
  gsap.to(sorryText, { y:-6, repeat:-1, yoyo:true, duration:4, ease:"sine.inOut" });

  function showStage(s){
    // hide all the main scenes
    const all = [stage1, stage2, stageWait, stage3A, stage3N, stageNext, stageHaan, stageNa, stageOneDay, stageOneWeek];
    all.forEach(x => x.classList.add('hidden'));
    s.classList.remove('hidden');
  }

  // cinematic BOOM helper: flash + confetti + scale then show target stage
  function boomTo(targetStage){
    // small flash
    gsap.set(boomFlash, { opacity: 0.9 });
    gsap.to(boomFlash, { opacity: 0.0, duration: 0.8, ease: "power2.out" });

    // small global boom scale on card
    const card = document.querySelector('.card');
    gsap.timeline()
      .to(card, { scale: 1.06, duration: 0.12, ease: "power2.out" })
      .to(card, { scale: 0.98, duration: 0.12 })
      .to(card, { opacity: 0, scale: 0.95, duration: 0.38, onComplete: () => {
        // confetti burst for extra cinematic effect
        softHeartConfetti();
        // show the target stage
        showStage(targetStage);
        // fade/scale-in the card area
        gsap.from(targetStage, { opacity: 0, y: 16, duration: 0.55, ease: "power2.out" });
        // restore card for later when user returns
        gsap.set(card, { opacity: 1, scale: 1 });
      }});
  }

  // pressing Say Sorry -> show choices and animate broken-heart split
  sayBtn.addEventListener('click', () => {
    // animate a little pop
    gsap.timeline()
      .to(sayBtn, { scale:0.96, duration:0.08 })
      .to(sayBtn, { scale:1, duration:0.12 });

    // split heart animation then show choices
    const tl = gsap.timeline({
      onComplete: ()=> {
        showStage(stage2);
        gsap.from('.choice', { scale:0.94, opacity:0, duration:0.5, stagger:0.08, ease:"back.out(1.2)" });
      }
    });

    tl.to('#brokenHeart', { scale:1.02, duration:0.25, ease:"power1.out" }, 0)
      .to(leftHalf, { x:-28, rotation:-0.25, duration:0.7, ease:"power2.out" }, 0.08)
      .to(rightHalf, { x:28, rotation:0.25, duration:0.7, ease:"power2.out" }, 0.08)
      .to(crack, { stroke:"#4d2b3a", duration:0.06, repeat:6, yoyo:true, ease:"rough" }, 0.14)
      .to('#sorryText', { opacity:0.25, duration:0.7, ease:"power1.out" }, 0.28);
  });

  // Accept flow -> BOOM -> stageNext
  acceptBtn.addEventListener('click', () => {
    acceptBtn.disabled = true; notNowBtn.disabled = true;
    // play music (user interaction)
    if(bgMusic && bgMusic.paused){ bgMusic.volume=0.45; const p = bgMusic.play(); if(p && p.catch) p.catch(()=>{}); }

    // tiny press animation
    gsap.timeline().to(acceptBtn, { scale:0.96, duration:0.06 }).to(acceptBtn, { scale:1, duration:0.12 });

    // bring halves together (mend) then boomTo next screen
    const tl = gsap.timeline();
    tl.to(leftHalf, { x:-6, rotation:-0.06, duration:1.0, ease:"power2.inOut" }, 0.2)
      .to(rightHalf, { x:6, rotation:0.06, duration:1.0, ease:"power2.inOut" }, 0.2)
      .to('#sorryText', { opacity:1, color:'#6b2d5c', duration:0.9, ease:"elastic.out(1,0.7)" }, 0.6)
      .to('#sorryText', { scale:1.02, duration:0.5, ease:"power1.out" }, 1.2)
      .to({}, { duration: 0.25, onComplete: ()=> boomTo(stageNext) }, 1.6);
  });

  // Next screen handlers (haan / na) -> boomTo separate cinematic screens
  haanBtn.addEventListener('click', () => {
    // small press
    gsap.timeline().to(haanBtn, { scale:0.96, duration:0.06 }).to(haanBtn, { scale:1, duration:0.12 });
    // BOOM to haan screen
    boomTo(stageHaan);
  });
  naBtn.addEventListener('click', () => {
    gsap.timeline().to(naBtn, { scale:0.96, duration:0.06 }).to(naBtn, { scale:1, duration:0.12 });
    boomTo(stageNa);
  });

  // Done / Done buttons from cinematic screens return to stage1 (or stage2)
  function returnToHome(){
    // stop music if playing (optional)
    if(bgMusic && !bgMusic.paused){ bgMusic.pause(); bgMusic.currentTime = 0; }
    // return to initial stage1
    showStage(stage1);
    // reset heart halves
    gsap.to([leftHalf, rightHalf], { x:0, rotation:0, duration:0.9, ease:"elastic.out(1,0.6)" });
  }
  doneHaan.addEventListener('click', returnToHome);
  doneNa.addEventListener('click', returnToHome);
  doneDay.addEventListener('click', returnToHome);
  doneWeek.addEventListener('click', returnToHome);

  // Not Now -> show wait choices screen (then boomTo its own cinematic screens)
  notNowBtn.addEventListener('click', () => {
    gsap.timeline().to(notNowBtn, { scale:0.96, duration:0.06 }).to(notNowBtn, { scale:1, duration:0.12 });
    showStage(stageWait);
    gsap.from('#waitMsg', { scale:0.95, opacity:0, duration:0.7, ease:"elastic.out(1,0.6)" });
    gsap.from('.choice', { scale:0.94, opacity:0, duration:0.45, stagger:0.08, ease:"back.out(1.2)" });
    gsap.to(leftHalf, { x:-18, rotation:-0.12, duration:0.6, ease:"power2.out" });
    gsap.to(rightHalf, { x:18, rotation:0.12, duration:0.6, ease:"power2.out" });
  });

  // Wait choices -> boom to own pages
  oneDayBtn.addEventListener('click', () => {
    gsap.timeline().to(oneDayBtn, { scale:0.96, duration:0.06 }).to(oneDayBtn, { scale:1, duration:0.12 });
    boomTo(stageOneDay);
  });
  oneWeekBtn.addEventListener('click', () => {
    gsap.timeline().to(oneWeekBtn, { scale:0.96, duration:0.06 }).to(oneWeekBtn, { scale:1, duration:0.12 });
    boomTo(stageOneWeek);
  });

  // Back from wait -> stage2
  backFromWait.addEventListener('click', () => {
    showStage(stage2);
    gsap.from('.choice', { scale:0.94, opacity:0, duration:0.45, stagger:0.08, ease:"back.out(1.2)" });
    gsap.to([leftHalf, rightHalf], { x: function(i,t){ return i===0 ? -22 : 22; }, duration:0.6, rotation: function(i){ return i===0 ? -0.12 : 0.12; }, ease:"power2.out" });
  });

  // Try again later -> go back to stage2
  tryLater.addEventListener('click', () => {
    showStage(stage2);
    gsap.from('.choice', { scale:0.94, opacity:0, duration:0.45, stagger:0.08, ease:"back.out(1.2)" });
    gsap.to([leftHalf, rightHalf], { x: function(i,t){ return i===0 ? -22 : 22; }, duration:0.6, rotation: function(i){ return i===0 ? -0.12 : 0.12; }, ease:"power2.out" });
  });

  // Close Accept fallback
  closeAccept.addEventListener('click', () => {
    showStage(stage1);
    gsap.to([leftHalf, rightHalf], { x:0, rotation:0, duration:0.9, ease:"elastic.out(1,0.6)" });
    if(cuteImage) gsap.to(cuteImage, { opacity:0, duration:0.5, onComplete: ()=> { if(cuteImage) cuteImage.style.display='none'; } });
  });

  // Keyboard accessibility
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      const activeStage = (!stage2.classList.contains('hidden')) ? 2 : (!stage3A.classList.contains('hidden') || !stage3N.classList.contains('hidden')) ? 3 : (!stageNext.classList.contains('hidden')) ? 4 : 1;
      if (activeStage === 1) sayBtn.click();
      else if (activeStage === 2) acceptBtn.click();
    }
  });

  // default show stage1
  showStage(stage1);
  gsap.from('.card', { y: 18, opacity:0, duration:0.9, ease: "power2.out" });
  gsap.from('#sorryText', { y: 16, opacity:0, duration:0.9, delay:0.06, ease:"back.out(1.2)" });

  /* helpers for confetti & floating hearts (DOM) - unchanged */
  function softHeartConfetti(){
    confetti({
      particleCount: 80,
      spread: 70,
      startVelocity: 30,
      ticks: 240,
      gravity: 0.6,
      origin: { y: 0.6 },
      colors: ['#ff6b8a','#ff9fb3','#ffd1de'],
    });
    setTimeout(()=> {
      confetti({ particleCount: 20, angle: 60, spread: 45, origin: { x: 0 }, colors: ['#ff9fb3','#ff6b8a'] });
      confetti({ particleCount: 20, angle: 120, spread: 45, origin: { x: 1 }, colors: ['#ff9fb3','#ff6b8a'] });
    }, 200);
  }

  function createFloatingHearts(count){
    for(let i=0;i<count;i++){
      const el = document.createElement('div');
      el.textContent = 'üíå';
      el.style.position = 'fixed';
      el.style.left = (20 + Math.random()*60) + '%';
      el.style.bottom = (6 + Math.random()*6) + '%';
      el.style.fontSize = (12 + Math.random()*28) + 'px';
      el.style.zIndex = 1200;
      el.style.pointerEvents = 'none';
      document.body.appendChild(el);
      const dur = 2.5 + Math.random()*1.8;
      gsap.to(el, { y: -220 - Math.random()*100, x: (Math.random()*120 - 60), opacity:0, scale: 1.3, duration: dur, ease:"power1.out", onComplete: ()=> el.remove() });
    }
  }

})();
</script>
</body>
</html>
